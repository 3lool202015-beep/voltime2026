<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .barcode-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .attendance-card {
            transition: all 0.3s ease;
        }
        .attendance-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
        }
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
        }
        .print-only { display: none; }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-gradient-to-br from-blue-50 to-indigo-100">
  <div class="container mx-auto px-4 py-8"><!-- Header -->
   <header class="text-center mb-8">
    <h1 id="main-title" class="text-4xl font-bold text-gray-800 mb-2">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</h1>
    <p id="organization-subtitle" class="text-lg text-gray-600">Ù…Ù†ØµØ© Ø´Ø§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</p>
   </header><!-- Admin Menu (Three Dots) -->
   <div class="fixed top-4 left-4 z-50">
    <div class="relative"><button id="admin-menu-btn" onclick="toggleAdminMenu()" class="bg-gray-600 hover:bg-gray-700 text-white p-3 rounded-full shadow-lg transition-colors">
      <svg class="w-6 h-6" fill="currentColor" viewbox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
      </svg></button> <!-- Admin Dropdown Menu -->
     <div id="admin-dropdown" class="hidden absolute top-12 left-0 bg-white rounded-lg shadow-xl border min-w-48 py-2"><button onclick="showAdminLogin()" class="w-full text-right px-4 py-3 hover:bg-gray-50 text-gray-700 font-medium transition-colors"> ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù </button>
      <div class="border-t my-1"></div>
      <div class="px-4 py-2 text-xs text-gray-500">
       Ù„Ù„Ù…Ø´Ø±ÙÙŠÙ† ÙÙ‚Ø·
      </div>
     </div>
    </div>
   </div><!-- Login Section -->
   <div id="login-section" class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-8 mb-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
    <div class="space-y-4"><button onclick="showVolunteerRegistration()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"> ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ·ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ </button>
    </div>
   </div><!-- Admin Login Section -->
   <div id="admin-login-section" class="hidden max-w-md mx-auto bg-white rounded-lg shadow-lg p-8 mb-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù</h2>
    <form id="admin-login-form" class="space-y-6">
     <div><label for="admin_username_login" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label> <input type="text" id="admin_username_login" name="admin_username" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
     </div>
     <div><label for="admin_password_login" class="block text-sm font-medium text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label> <input type="password" id="admin_password_login" name="admin_password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
     </div><button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ </button> <button type="button" onclick="backToLogin()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"> Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© </button>
    </form>
   </div><!-- Navigation Tabs (Admin Only) -->
   <nav id="admin-nav" class="hidden flex flex-wrap justify-center mb-8 bg-white rounded-lg shadow-md p-2"><button onclick="showTab('scanner')" class="tab-button active px-6 py-3 mx-1 mb-2 rounded-lg font-semibold transition-colors"> Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ </button> <button onclick="showTab('volunteers')" class="tab-button px-6 py-3 mx-1 mb-2 rounded-lg font-semibold transition-colors"> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† </button> <button onclick="showTab('reports')" class="tab-button px-6 py-3 mx-1 mb-2 rounded-lg font-semibold transition-colors"> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª </button> <button onclick="showTab('admin')" class="tab-button px-6 py-3 mx-1 mb-2 rounded-lg font-semibold transition-colors"> Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© </button> <button onclick="logout()" class="px-6 py-3 mx-1 mb-2 rounded-lg font-semibold transition-colors bg-red-600 hover:bg-red-700 text-white"> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ </button>
   </nav><!-- Registration Tab -->
   <div id="registration" class="tab-content">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
     <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ·ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h2>
     <form id="volunteer-form" class="space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
       <div><label for="name" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label> <input type="text" id="name" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
       </div>
       <div><label for="civil_id" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ (12 Ø±Ù‚Ù…)</label> <input type="text" id="civil_id" name="civil_id" required pattern="[0-9]{12}" maxlength="12" minlength="12" placeholder="123456789012" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <p class="text-xs text-gray-500 mt-1">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 12 Ø±Ù‚Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·</p>
       </div>
       <div><label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (6 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)</label> <input type="tel" id="phone" name="phone" required pattern="[0-9]{6,}" minlength="6" placeholder="123456" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <p class="text-xs text-gray-500 mt-1">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 6 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</p>
       </div>
       <div><label for="gender" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù†ÙˆØ¹</label> <select id="gender" name="gender" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option> <option value="male">Ø°ÙƒØ±</option> <option value="female">Ø£Ù†Ø«Ù‰</option> </select>
       </div>
      </div>
      <div><label for="email" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label> <input type="email" id="email" name="email" required placeholder="example@email.com" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
       <p class="text-xs text-gray-500 mt-1">Ù…Ø·Ù„ÙˆØ¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</p>
      </div>
      <div><label for="event_name" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ Ø¨Ù‡Ø§</label> <input type="text" id="event_name" name="event_name" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©">
      </div><button type="submit" id="register-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªØ·ÙˆØ¹ </button> <button type="button" onclick="backToLogin()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"> Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© </button>
     </form><!-- Success Message -->
     <div id="registration-success" class="hidden mt-6 p-6 bg-green-50 border border-green-200 rounded-lg">
      <h3 class="text-lg font-semibold text-green-800 mb-4">ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h3>
      <div id="barcode-display" class="barcode-container mb-4">
       <svg id="barcode"></svg>
       <p class="mt-2 text-sm text-gray-600">Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ·ÙˆØ¹</p>
      </div>
      <div class="flex flex-wrap gap-2 justify-center"><button onclick="printBarcode()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg"> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ </button> <button id="resend-email-btn" onclick="resendEmail()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"> Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ </button> <button onclick="resetForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg"> ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ·ÙˆØ¹ Ø¢Ø®Ø± </button>
      </div>
     </div>
    </div>
   </div><!-- Scanner Tab (Admin Only) -->
   <div id="scanner" class="tab-content admin-only hidden">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
     <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h2><!-- Camera Scanner Section -->
     <div class="space-y-6"><!-- Camera Instructions -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
       <h4 class="text-blue-800 font-semibold mb-2">ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:</h4>
       <ul class="text-blue-700 text-sm space-y-1">
        <li>â€¢ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§" Ø£Ø¯Ù†Ø§Ù‡</li>
        <li>â€¢ Ø§Ø³Ù…Ø­ Ù„Ù„Ù…ØªØµÙØ­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø·Ù„Ø¨</li>
        <li>â€¢ ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨ÙˆØ¶ÙˆØ­</li>
        <li>â€¢ Ø¥Ø°Ø§ Ù„Ù… ØªØ¹Ù…Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ</li>
       </ul>
      </div>
      <div class="text-center"><button id="start-camera-btn" onclick="startCamera()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors mb-4"> ğŸ“· ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ </button> <button id="stop-camera-btn" onclick="stopCamera()" class="hidden bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors mb-4"> Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ </button>
      </div><!-- Camera Video Element -->
      <div id="camera-container" class="hidden">
       <div class="relative bg-black rounded-lg overflow-hidden">
        <video id="camera-video" class="w-full h-64 object-cover" autoplay muted playsinline></video>
        <div class="absolute inset-0 border-2 border-red-500 opacity-50 pointer-events-none">
         <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-48 h-32 border-4 border-red-500 bg-transparent"></div>
        </div>
        <canvas id="camera-canvas" class="hidden"></canvas>
       </div>
       <p class="text-center text-sm text-gray-600 mt-2">ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±Ø¨Ø¹</p>
      </div><!-- Manual Input Alternative -->
      <div class="border-t pt-6"><label for="barcode-input" class="block text-sm font-medium text-gray-700 mb-2">Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹</label> <input type="text" id="barcode-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div class="grid grid-cols-2 gap-4"><button onclick="recordAttendance('checkin')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"> ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± </button> <button onclick="recordAttendance('checkout')" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù </button>
      </div>
     </div><!-- Attendance Result -->
     <div id="attendance-result" class="hidden mt-6 p-6 rounded-lg">
      <div id="attendance-info"></div>
     </div>
    </div>
   </div><!-- Volunteers List Tab (Admin Only) -->
   <div id="volunteers" class="tab-content admin-only hidden">
    <div class="bg-white rounded-lg shadow-lg p-8">
     <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</h2>
     <div id="volunteers-list" class="space-y-4"><!-- Volunteers will be displayed here -->
     </div>
    </div>
   </div><!-- Reports Tab (Admin Only) -->
   <div id="reports" class="tab-content admin-only hidden">
    <div class="bg-white rounded-lg shadow-lg p-8">
     <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</h2>
     <div class="space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
       <div class="p-6 bg-blue-50 rounded-lg">
        <h3 class="text-lg font-semibold text-blue-800 mb-4">Ø¥Ø±Ø³Ø§Ù„ Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</h3><button onclick="sendAllCertificates()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold"> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† </button>
       </div>
       <div class="p-6 bg-green-50 rounded-lg">
        <h3 class="text-lg font-semibold text-green-800 mb-4">ØªÙ‚Ø±ÙŠØ± Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ·ÙˆØ¹</h3><button onclick="generateHoursReport()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold"> Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ø§Ø¹Ø§Øª </button>
       </div>
      </div>
      <div id="reports-output" class="mt-6"><!-- Reports will be displayed here -->
      </div>
     </div>
    </div>
   </div><!-- Admin Tab (Admin Only) -->
   <div id="admin" class="tab-content admin-only hidden">
    <div class="bg-white rounded-lg shadow-lg p-8">
     <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-blue-50 p-6 rounded-lg text-center">
       <h3 class="text-2xl font-bold text-blue-600" id="total-volunteers">0</h3>
       <p class="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</p>
      </div>
      <div class="bg-green-50 p-6 rounded-lg text-center">
       <h3 class="text-2xl font-bold text-green-600" id="present-volunteers">0</h3>
       <p class="text-gray-600">Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ†</p>
      </div>
      <div class="bg-orange-50 p-6 rounded-lg text-center">
       <h3 class="text-2xl font-bold text-orange-600" id="total-hours">0</h3>
       <p class="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ·ÙˆØ¹</p>
      </div>
     </div>
     <div class="space-y-4">
      <h3 class="text-lg font-semibold text-gray-800">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><button onclick="exportData()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold"> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª </button> <button onclick="resetAllData()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold"> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª </button>
      </div>
     </div>
    </div>
   </div><!-- Loading Indicator -->
   <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg text-center">
     <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
     <p class="text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
    </div>
   </div><!-- Toast Messages -->
   <div id="toast" class="hidden fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50"><span id="toast-message"></span>
   </div>
  </div>
  <script>
        // Configuration
        const defaultConfig = {
            organization_name: "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„ØªØ·ÙˆØ¹",
            default_event: "ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„ØªØ·ÙˆØ¹ 2024",
            admin_email: "admin@volunteer.org",
            primary_color: "#3b82f6",
            secondary_color: "#f8fafc",
            text_color: "#1f2937",
            success_color: "#10b981",
            danger_color: "#ef4444"
        };

        let volunteers = [];
        let currentRecordCount = 0;
        let isAdminLoggedIn = false;
        let cameraStream = null;
        let scanningInterval = null;
        let lastRegisteredVolunteer = null;

        // Admin credentials
        const ADMIN_USERNAME = "ali";
        const ADMIN_PASSWORD = "123456789";

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                volunteers = data;
                currentRecordCount = data.length;
                updateVolunteersList();
                updateAdminStats();
            }
        };

        // Initialize SDKs
        async function initializeApp() {
            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.init(dataHandler);
                    if (!result.isOk) {
                        console.error("Failed to initialize data SDK");
                    }
                }

                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange: async (config) => {
                            document.getElementById('main-title').textContent = config.organization_name || defaultConfig.organization_name;
                            document.getElementById('organization-subtitle').textContent = config.default_event || defaultConfig.default_event;
                            
                            // Set default event in registration form
                            const eventInput = document.getElementById('event_name');
                            if (eventInput && !eventInput.value) {
                                eventInput.value = config.default_event || defaultConfig.default_event;
                            }
                            
                            // Apply colors
                            const primaryColor = config.primary_color || defaultConfig.primary_color;
                            const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
                            const textColor = config.text_color || defaultConfig.text_color;
                            
                            document.body.style.color = textColor;
                            
                            // Update button colors
                            const buttons = document.querySelectorAll('.bg-blue-600');
                            buttons.forEach(btn => {
                                btn.style.backgroundColor = primaryColor;
                            });
                        },
                        mapToCapabilities: (config) => ({
                            recolorables: [
                                {
                                    get: () => config.primary_color || defaultConfig.primary_color,
                                    set: (value) => {
                                        config.primary_color = value;
                                        window.elementSdk.setConfig({ primary_color: value });
                                    }
                                },
                                {
                                    get: () => config.secondary_color || defaultConfig.secondary_color,
                                    set: (value) => {
                                        config.secondary_color = value;
                                        window.elementSdk.setConfig({ secondary_color: value });
                                    }
                                },
                                {
                                    get: () => config.text_color || defaultConfig.text_color,
                                    set: (value) => {
                                        config.text_color = value;
                                        window.elementSdk.setConfig({ text_color: value });
                                    }
                                }
                            ],
                            borderables: [],
                            fontEditable: undefined,
                            fontSizeable: undefined
                        }),
                        mapToEditPanelValues: (config) => new Map([
                            ["organization_name", config.organization_name || defaultConfig.organization_name],
                            ["default_event", config.default_event || defaultConfig.default_event],
                            ["admin_email", config.admin_email || defaultConfig.admin_email]
                        ])
                    });
                }
            } catch (error) {
                console.error("Initialization error:", error);
            }
        }

        // Admin Menu Management
        function toggleAdminMenu() {
            const dropdown = document.getElementById('admin-dropdown');
            dropdown.classList.toggle('hidden');
        }

        function showAdminLogin() {
            hideAllSections();
            document.getElementById('admin-login-section').classList.remove('hidden');
            document.getElementById('admin-dropdown').classList.add('hidden');
        }

        // Login Management
        function showVolunteerRegistration() {
            hideAllSections();
            document.getElementById('registration').classList.remove('hidden');
            document.getElementById('registration').classList.add('active');
            
            // Set default event name
            const eventInput = document.getElementById('event_name');
            if (window.elementSdk && window.elementSdk.config) {
                eventInput.value = window.elementSdk.config.default_event || defaultConfig.default_event;
            } else {
                eventInput.value = defaultConfig.default_event;
            }
        }

        function backToLogin() {
            hideAllSections();
            document.getElementById('login-section').classList.remove('hidden');
            
            // Reset forms
            document.getElementById('volunteer-form').reset();
            document.getElementById('admin-login-form').reset();
            document.getElementById('registration-success').classList.add('hidden');
            document.getElementById('volunteer-form').style.display = 'block';
        }

        function hideAllSections() {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('admin-login-section').classList.add('hidden');
            document.getElementById('admin-nav').classList.add('hidden');
            document.getElementById('admin-dropdown').classList.add('hidden');
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
                tab.classList.add('hidden');
            });
        }

        // Logout
        function logout() {
            isAdminLoggedIn = false;
            if (cameraStream) {
                stopCamera();
            }
            backToLogin();
            showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­");
        }

        // Tab Management (Admin Only)
        function showTab(tabName) {
            if (!isAdminLoggedIn) {
                showToast("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø´Ø±Ù Ø£ÙˆÙ„Ø§Ù‹", "error");
                return;
            }
            
            // Stop camera if switching away from scanner tab
            if (tabName !== 'scanner' && cameraStream) {
                stopCamera();
            }
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
                tab.classList.add('hidden');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            selectedTab.classList.add('active');
            selectedTab.classList.remove('hidden');
            
            // Add active class to clicked button
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Find and activate the corresponding button
                const buttons = document.querySelectorAll('.tab-button');
                buttons.forEach(btn => {
                    if (btn.onclick && btn.onclick.toString().includes(tabName)) {
                        btn.classList.add('active');
                    }
                });
            }
        }

        // Generate unique barcode
        function generateBarcode() {
            return 'VOL' + Date.now().toString().slice(-8) + Math.random().toString(36).substr(2, 4).toUpperCase();
        }

        // Validate civil ID and age
        function validateCivilId(civilId) {
            if (!/^\d{12}$/.test(civilId)) {
                return { valid: false, message: "Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 12 Ø±Ù‚Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·" };
            }
            
            // Extract birth year from civil ID (assuming format: YYMMDDXXXXXX)
            const year = parseInt(civilId.substring(0, 2));
            const currentYear = new Date().getFullYear() % 100;
            let birthYear = year;
            
            // Determine century
            if (year <= currentYear) {
                birthYear = 2000 + year;
            } else {
                birthYear = 1900 + year;
            }
            
            const age = new Date().getFullYear() - birthYear;
            
            if (age < 16) {
                return { valid: false, message: "Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ù…Ø± Ø§Ù„Ù…ØªØ·ÙˆØ¹ 16 Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" };
            }
            
            return { valid: true, age: age };
        }

        // Validate phone number
        function validatePhone(phone) {
            if (!/^\d{6,}$/.test(phone)) {
                return { valid: false, message: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 6 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" };
            }
            return { valid: true };
        }

        // Generate Barcode using JsBarcode library
        function generateQRCode(text) {
            try {
                // Clear previous barcode
                const barcodeContainer = document.getElementById('barcode');
                barcodeContainer.innerHTML = '';
                
                // Create SVG element for barcode
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '300');
                svg.setAttribute('height', '100');
                
                // Generate barcode using JsBarcode
                JsBarcode(svg, text, {
                    format: "CODE128",
                    width: 2,
                    height: 80,
                    displayValue: true,
                    fontSize: 14,
                    textMargin: 5,
                    background: "#ffffff",
                    lineColor: "#000000"
                });
                
                barcodeContainer.appendChild(svg);
                
                // Add text below barcode
                const textDiv = document.createElement('div');
                textDiv.className = 'mt-2 text-sm font-mono text-gray-800';
                textDiv.textContent = text;
                barcodeContainer.appendChild(textDiv);
                
            } catch (error) {
                console.error('Error generating barcode:', error);
                // Fallback: create simple text-based barcode
                const barcodeContainer = document.getElementById('barcode');
                barcodeContainer.innerHTML = `
                    <div class="bg-white p-4 border-2 border-gray-300 rounded">
                        <div class="text-center">
                            <div class="font-mono text-2xl font-bold mb-2">${text}</div>
                            <div class="text-sm text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ·ÙˆØ¹</div>
                        </div>
                    </div>
                `;
            }
        }

        // Send registration email
        async function sendRegistrationEmail(volunteerData) {
            try {
                // Create email template data
                const templateParams = {
                    to_name: volunteerData.name,
                    to_email: volunteerData.email,
                    volunteer_name: volunteerData.name,
                    volunteer_id: volunteerData.civil_id,
                    volunteer_phone: volunteerData.phone,
                    volunteer_barcode: volunteerData.barcode,
                    event_name: volunteerData.event_name,
                    registration_date: new Date(volunteerData.registration_date).toLocaleDateString('ar-SA'),
                    organization_name: window.elementSdk?.config?.organization_name || defaultConfig.organization_name,
                    message: `
Ù…Ø±Ø­Ø¨Ø§Ù‹ ${volunteerData.name}ØŒ

ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙƒÙ…ØªØ·ÙˆØ¹ ÙÙŠ ${volunteerData.event_name}

Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„:
- Ø§Ù„Ø§Ø³Ù…: ${volunteerData.name}
- Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ: ${volunteerData.civil_id}
- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${volunteerData.phone}
- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${volunteerData.email}
- Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©: ${volunteerData.event_name}
- Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${volunteerData.barcode}
- ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${new Date(volunteerData.registration_date).toLocaleDateString('ar-SA')}

ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ: ${volunteerData.barcode}

Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ ØªØ·ÙˆØ¹Ùƒ Ù…Ø¹Ù†Ø§!

${window.elementSdk?.config?.organization_name || defaultConfig.organization_name}
                    `
                };

                // Simulate successful email sending
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                console.log('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰:', volunteerData.email);
                console.log('Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø±ÙŠØ¯:', templateParams.message);
                
                return true;
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:', error);
                throw error;
            }
        }

        // Admin login
        async function adminLogin(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const adminUsername = formData.get('admin_username');
            const adminPassword = formData.get('admin_password');
            
            if (adminUsername === ADMIN_USERNAME && adminPassword === ADMIN_PASSWORD) {
                // Admin login successful
                isAdminLoggedIn = true;
                hideAllSections();
                document.getElementById('admin-nav').classList.remove('hidden');
                showTab('scanner');
                showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù Ø¨Ù†Ø¬Ø§Ø­!");
            } else {
                showToast("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù ØºÙŠØ± ØµØ­ÙŠØ­Ø©", "error");
            }
        }

        // Register volunteer
        async function registerVolunteer(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            if (currentRecordCount >= 999) {
                showToast("ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† (999). ÙŠØ±Ø¬Ù‰ Ø­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.", "error");
                return;
            }
            
            // Validate civil ID
            const civilIdValidation = validateCivilId(formData.get('civil_id'));
            if (!civilIdValidation.valid) {
                showToast(civilIdValidation.message, "error");
                return;
            }
            
            // Validate phone
            const phoneValidation = validatePhone(formData.get('phone'));
            if (!phoneValidation.valid) {
                showToast(phoneValidation.message, "error");
                return;
            }

            showLoading(true);
            
            const barcode = generateBarcode();
            
            const volunteerData = {
                id: barcode,
                name: formData.get('name'),
                civil_id: formData.get('civil_id'),
                phone: formData.get('phone'),
                gender: formData.get('gender'),
                email: formData.get('email'),
                event_name: formData.get('event_name'),
                barcode: barcode,
                registration_date: new Date().toISOString(),
                attendance_records: JSON.stringify([]),
                total_hours: 0,
                status: 'registered'
            };

            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.create(volunteerData);
                    if (result.isOk) {
                        // Store volunteer data for potential email resending
                        lastRegisteredVolunteer = volunteerData;
                        
                        // Generate and display barcode
                        generateQRCode(barcode);
                        
                        // Send registration email
                        try {
                            await sendRegistrationEmail(volunteerData);
                            showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªØ·ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ!");
                            
                            // Show detailed success message
                            const successMessage = `
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                                    <h4 class="text-green-800 font-semibold mb-2">âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!</h4>
                                    <p class="text-green-700 text-sm mb-2">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¥Ù„Ù‰:</p>
                                    <p class="text-green-800 font-medium">${volunteerData.email}</p>
                                    <p class="text-green-600 text-xs mt-2">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙˆØ§Ø±Ø¯ Ø£Ùˆ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§</p>
                                </div>
                            `;
                            
                            // Add success message to registration success div
                            const successDiv = document.getElementById('registration-success');
                            const existingMessage = successDiv.querySelector('.bg-green-50');
                            if (existingMessage) {
                                existingMessage.remove();
                            }
                            successDiv.insertAdjacentHTML('afterbegin', successMessage);
                            
                        } catch (error) {
                            showToast("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙ„ÙƒÙ† ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ", "error");
                            
                            // Show error message
                            const errorMessage = `
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                    <h4 class="text-yellow-800 font-semibold mb-2">âš ï¸ ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹ ØªØ­Ø°ÙŠØ±</h4>
                                    <p class="text-yellow-700 text-sm">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªØ·ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙ„ÙƒÙ† ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
                                    <p class="text-yellow-600 text-xs mt-1">ÙŠØ±Ø¬Ù‰ Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: <strong>${volunteerData.barcode}</strong></p>
                                </div>
                            `;
                            
                            const successDiv = document.getElementById('registration-success');
                            successDiv.insertAdjacentHTML('afterbegin', errorMessage);
                        }
                        
                        document.getElementById('registration-success').classList.remove('hidden');
                        document.getElementById('volunteer-form').style.display = 'none';
                        
                    } else {
                        showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "error");
                    }
                }
            } catch (error) {
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "error");
            }
            
            showLoading(false);
        }

        // Resend email function
        async function resendEmail() {
            if (!lastRegisteredVolunteer) {
                showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ·ÙˆØ¹ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„", "error");
                return;
            }

            const resendBtn = document.getElementById('resend-email-btn');
            resendBtn.disabled = true;
            resendBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            
            try {
                await sendRegistrationEmail(lastRegisteredVolunteer);
                showToast("ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­!");
                
                // Update success message
                const successDiv = document.getElementById('registration-success');
                const existingMessage = successDiv.querySelector('.bg-green-50, .bg-yellow-50');
                if (existingMessage) {
                    existingMessage.remove();
                }
                
                const successMessage = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                        <h4 class="text-green-800 font-semibold mb-2">âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!</h4>
                        <p class="text-green-700 text-sm mb-2">ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¥Ù„Ù‰:</p>
                        <p class="text-green-800 font-medium">${lastRegisteredVolunteer.email}</p>
                        <p class="text-green-600 text-xs mt-2">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙˆØ§Ø±Ø¯ Ø£Ùˆ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§</p>
                    </div>
                `;
                successDiv.insertAdjacentHTML('afterbegin', successMessage);
                
            } catch (error) {
                showToast("ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ", "error");
            }
            
            resendBtn.disabled = false;
            resendBtn.textContent = 'Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯';
        }

        // Record attendance
        async function recordAttendance(type) {
            const barcodeInput = document.getElementById('barcode-input');
            const barcode = barcodeInput.value.trim();
            
            if (!barcode) {
                showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯", "error");
                return;
            }

            showLoading(true);
            
            const volunteer = volunteers.find(v => v.barcode === barcode);
            if (!volunteer) {
                showToast("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ØªØ·ÙˆØ¹ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯", "error");
                showLoading(false);
                return;
            }

            const now = new Date();
            const attendanceRecords = JSON.parse(volunteer.attendance_records || '[]');
            
            const newRecord = {
                type: type,
                timestamp: now.toISOString(),
                date: now.toLocaleDateString('ar-SA'),
                time: now.toLocaleTimeString('ar-SA')
            };

            attendanceRecords.push(newRecord);
            
            // Calculate hours if this is a checkout
            let additionalHours = 0;
            if (type === 'checkout') {
                const lastCheckin = attendanceRecords.slice().reverse().find(r => r.type === 'checkin');
                if (lastCheckin) {
                    const checkinTime = new Date(lastCheckin.timestamp);
                    const checkoutTime = new Date(newRecord.timestamp);
                    additionalHours = (checkoutTime - checkinTime) / (1000 * 60 * 60); // Convert to hours
                }
            }

            const updatedVolunteer = {
                ...volunteer,
                attendance_records: JSON.stringify(attendanceRecords),
                total_hours: volunteer.total_hours + additionalHours,
                status: type === 'checkin' ? 'present' : 'absent'
            };

            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.update(updatedVolunteer);
                    if (result.isOk) {
                        const resultDiv = document.getElementById('attendance-result');
                        const infoDiv = document.getElementById('attendance-info');
                        
                        resultDiv.className = `mt-6 p-6 rounded-lg ${type === 'checkin' ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}`;
                        
                        infoDiv.innerHTML = `
                            <h3 class="text-lg font-semibold ${type === 'checkin' ? 'text-green-800' : 'text-red-800'} mb-2">
                                ${type === 'checkin' ? 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±' : 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù'}
                            </h3>
                            <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${volunteer.name}</p>
                            <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${newRecord.time}</p>
                            <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${newRecord.date}</p>
                            ${type === 'checkin' ? `<p><strong>Ø³Ø§Ø¹Ø© Ø§Ù„Ø­Ø¶ÙˆØ±:</strong> ${newRecord.time}</p>` : ''}
                            ${type === 'checkout' ? `<p><strong>Ø³Ø§Ø¹Ø© Ø§Ù„Ø§Ù†ØµØ±Ø§Ù:</strong> ${newRecord.time}</p>` : ''}
                            ${type === 'checkout' && additionalHours > 0 ? `<p><strong>Ø³Ø§Ø¹Ø§Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©:</strong> ${additionalHours.toFixed(2)} Ø³Ø§Ø¹Ø©</p>` : ''}
                            <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ·ÙˆØ¹:</strong> ${updatedVolunteer.total_hours.toFixed(2)} Ø³Ø§Ø¹Ø©</p>
                        `;
                        
                        resultDiv.classList.remove('hidden');
                        barcodeInput.value = '';
                        
                        showToast(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${type === 'checkin' ? 'Ø§Ù„Ø­Ø¶ÙˆØ±' : 'Ø§Ù„Ø§Ù†ØµØ±Ø§Ù'} Ø¨Ù†Ø¬Ø§Ø­!`);
                    } else {
                        showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±", "error");
                    }
                }
            } catch (error) {
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±", "error");
            }
            
            showLoading(false);
        }

        // Update volunteers list
        function updateVolunteersList() {
            const container = document.getElementById('volunteers-list');
            
            if (volunteers.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ·ÙˆØ¹ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯</p>';
                return;
            }

            container.innerHTML = volunteers.map(volunteer => `
                <div class="attendance-card bg-gray-50 p-6 rounded-lg border">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">${volunteer.name}</h3>
                            <p class="text-sm text-gray-600">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ: ${volunteer.civil_id}</p>
                            <p class="text-sm text-gray-600">Ø§Ù„Ù‡Ø§ØªÙ: ${volunteer.phone}</p>
                            <p class="text-sm text-gray-600">Ø§Ù„Ø¨Ø±ÙŠØ¯: ${volunteer.email}</p>
                            <p class="text-sm text-gray-600">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©: ${volunteer.event_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        </div>
                        <div class="text-right">
                            <span class="inline-block px-3 py-1 rounded-full text-sm font-medium ${
                                volunteer.status === 'present' ? 'bg-green-100 text-green-800' : 
                                volunteer.status === 'absent' ? 'bg-red-100 text-red-800' : 
                                'bg-gray-100 text-gray-800'
                            }">
                                ${volunteer.status === 'present' ? 'Ø­Ø§Ø¶Ø±' : volunteer.status === 'absent' ? 'Ù…Ù†ØµØ±Ù' : 'Ù…Ø³Ø¬Ù„'}
                            </span>
                            <p class="text-sm text-gray-600 mt-2">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${volunteer.barcode}</p>
                            <p class="text-sm font-semibold text-blue-600">Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ·ÙˆØ¹: ${volunteer.total_hours.toFixed(2)}</p>
                        </div>
                    </div>
                    <div class="flex space-x-2 space-x-reverse">
                        <button onclick="sendCertificate('${volunteer.id}')" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
                            Ø¥Ø±Ø³Ø§Ù„ Ø´Ù‡Ø§Ø¯Ø©
                        </button>
                        <button onclick="deleteVolunteer('${volunteer.id}')" 
                                class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm">
                            Ø­Ø°Ù
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Update admin statistics
        function updateAdminStats() {
            document.getElementById('total-volunteers').textContent = volunteers.length;
            document.getElementById('present-volunteers').textContent = volunteers.filter(v => v.status === 'present').length;
            document.getElementById('total-hours').textContent = volunteers.reduce((sum, v) => sum + v.total_hours, 0).toFixed(1);
        }

        // Send certificate to individual volunteer
        async function sendCertificate(volunteerId) {
            const volunteer = volunteers.find(v => v.id === volunteerId);
            if (!volunteer) return;

            showLoading(true);
            
            // Simulate sending email
            setTimeout(() => {
                showToast(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¥Ù„Ù‰ ${volunteer.name} Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙŠØ¯ ${volunteer.email}`);
                showLoading(false);
            }, 2000);
        }

        // Send certificates to all volunteers
        async function sendAllCertificates() {
            if (volunteers.length === 0) {
                showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ·ÙˆØ¹ÙŠÙ† Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø¥Ù„ÙŠÙ‡Ù…", "error");
                return;
            }

            showLoading(true);
            
            // Simulate sending emails
            setTimeout(() => {
                const reportsOutput = document.getElementById('reports-output');
                reportsOutput.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-green-800 mb-4">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­</h3>
                        <p class="text-green-700">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¥Ù„Ù‰ ${volunteers.length} Ù…ØªØ·ÙˆØ¹</p>
                        <ul class="mt-4 space-y-2">
                            ${volunteers.map(v => `
                                <li class="text-sm text-green-600">âœ“ ${v.name} - ${v.email}</li>
                            `).join('')}
                        </ul>
                    </div>
                `;
                showToast(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${volunteers.length} Ø´Ù‡Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­!`);
                showLoading(false);
            }, 3000);
        }

        // Generate hours report
        function generateHoursReport() {
            if (volunteers.length === 0) {
                showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±", "error");
                return;
            }

            const totalHours = volunteers.reduce((sum, v) => sum + v.total_hours, 0);
            const avgHours = totalHours / volunteers.length;
            
            const reportsOutput = document.getElementById('reports-output');
            reportsOutput.innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-blue-800 mb-4">ØªÙ‚Ø±ÙŠØ± Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ·ÙˆØ¹</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="text-center">
                            <p class="text-2xl font-bold text-blue-600">${totalHours.toFixed(1)}</p>
                            <p class="text-sm text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-blue-600">${avgHours.toFixed(1)}</p>
                            <p class="text-sm text-gray-600">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø§Ø¹Ø§Øª</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-blue-600">${volunteers.length}</p>
                            <p class="text-sm text-gray-600">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</p>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="bg-blue-100">
                                    <th class="p-2 text-right">Ø§Ù„Ø§Ø³Ù…</th>
                                    <th class="p-2 text-right">Ø³Ø§Ø¹Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                                    <th class="p-2 text-right">Ø³Ø§Ø¹Ø© Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</th>
                                    <th class="p-2 text-right">Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ·ÙˆØ¹</th>
                                    <th class="p-2 text-right">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th class="p-2 text-right">Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${volunteers.map(v => {
                                    const attendanceRecords = JSON.parse(v.attendance_records || '[]');
                                    const lastCheckin = attendanceRecords.slice().reverse().find(r => r.type === 'checkin');
                                    const lastCheckout = attendanceRecords.slice().reverse().find(r => r.type === 'checkout');
                                    
                                    return `
                                    <tr class="border-b">
                                        <td class="p-2">${v.name}</td>
                                        <td class="p-2">${lastCheckin ? lastCheckin.time : 'Ù„Ù… ÙŠØ³Ø¬Ù„'}</td>
                                        <td class="p-2">${lastCheckout ? lastCheckout.time : 'Ù„Ù… ÙŠØ³Ø¬Ù„'}</td>
                                        <td class="p-2 font-semibold">${v.total_hours.toFixed(2)} Ø³Ø§Ø¹Ø©</td>
                                        <td class="p-2">
                                            <span class="px-2 py-1 rounded text-xs ${
                                                v.status === 'present' ? 'bg-green-100 text-green-800' : 
                                                v.status === 'absent' ? 'bg-red-100 text-red-800' : 
                                                'bg-gray-100 text-gray-800'
                                            }">
                                                ${v.status === 'present' ? 'Ø­Ø§Ø¶Ø±' : v.status === 'absent' ? 'Ù…Ù†ØµØ±Ù' : 'Ù…Ø³Ø¬Ù„'}
                                            </span>
                                        </td>
                                        <td class="p-2">${v.event_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    </tr>
                                `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Delete volunteer
        async function deleteVolunteer(volunteerId) {
            const volunteer = volunteers.find(v => v.id === volunteerId);
            if (!volunteer) return;

            // Create inline confirmation
            const volunteerCard = event.target.closest('.attendance-card');
            const originalContent = volunteerCard.innerHTML;
            
            volunteerCard.innerHTML = `
                <div class="text-center p-4">
                    <p class="text-lg font-semibold text-red-600 mb-4">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${volunteer.name}ØŸ</p>
                    <div class="space-x-4 space-x-reverse">
                        <button onclick="confirmDelete('${volunteerId}')" 
                                class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded">
                            Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù
                        </button>
                        <button onclick="cancelDelete(this, \`${originalContent.replace(/`/g, '\\`')}\`)" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
        }

        async function confirmDelete(volunteerId) {
            const volunteer = volunteers.find(v => v.id === volunteerId);
            if (!volunteer) return;

            showLoading(true);
            
            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.delete(volunteer);
                    if (result.isOk) {
                        showToast(`ØªÙ… Ø­Ø°Ù ${volunteer.name} Ø¨Ù†Ø¬Ø§Ø­`);
                    } else {
                        showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù", "error");
                    }
                }
            } catch (error) {
                showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù", "error");
            }
            
            showLoading(false);
        }

        function cancelDelete(button, originalContent) {
            const volunteerCard = button.closest('.attendance-card');
            volunteerCard.innerHTML = originalContent;
        }

        // Export data
        function exportData() {
            if (volunteers.length === 0) {
                showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±", "error");
                return;
            }

            const csvContent = "data:text/csv;charset=utf-8," 
                + "Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ,Ø§Ù„Ù‡Ø§ØªÙ,Ø§Ù„Ù†ÙˆØ¹,Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ,Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©,Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯,Ø³Ø§Ø¹Ø© Ø§Ù„Ø­Ø¶ÙˆØ±,Ø³Ø§Ø¹Ø© Ø§Ù„Ø§Ù†ØµØ±Ø§Ù,Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ·ÙˆØ¹,Ø§Ù„Ø­Ø§Ù„Ø©,ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„\n"
                + volunteers.map(v => {
                    const attendanceRecords = JSON.parse(v.attendance_records || '[]');
                    const lastCheckin = attendanceRecords.slice().reverse().find(r => r.type === 'checkin');
                    const lastCheckout = attendanceRecords.slice().reverse().find(r => r.type === 'checkout');
                    
                    return `"${v.name}","${v.civil_id}","${v.phone}","${v.gender}","${v.email}","${v.event_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}","${v.barcode}","${lastCheckin ? lastCheckin.time : 'Ù„Ù… ÙŠØ³Ø¬Ù„'}","${lastCheckout ? lastCheckout.time : 'Ù„Ù… ÙŠØ³Ø¬Ù„'}","${v.total_hours}","${v.status}","${new Date(v.registration_date).toLocaleDateString('ar-SA')}"`;
                }).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `volunteers_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast("ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
        }

        // Reset all data
        async function resetAllData() {
            if (volunteers.length === 0) {
                showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø­Ø°ÙÙ‡Ø§", "error");
                return;
            }

            // Create confirmation modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white p-8 rounded-lg max-w-md mx-4">
                    <h3 class="text-xl font-bold text-red-600 mb-4">ØªØ­Ø°ÙŠØ±!</h3>
                    <p class="text-gray-700 mb-6">Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø³ÙŠØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</p>
                    <div class="flex space-x-4 space-x-reverse">
                        <button onclick="executeReset()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded">
                            Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ø§Ù„ÙƒÙ„
                        </button>
                        <button onclick="closeModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            window.closeModal = () => {
                document.body.removeChild(modal);
            };
            
            window.executeReset = async () => {
                showLoading(true);
                document.body.removeChild(modal);
                
                try {
                    if (window.dataSdk) {
                        for (const volunteer of volunteers) {
                            await window.dataSdk.delete(volunteer);
                        }
                        showToast("ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
                    }
                } catch (error) {
                    showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
                }
                
                showLoading(false);
            };
        }

        // Print barcode
        function printBarcode() {
            const printContent = document.getElementById('barcode-display').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</title>
                        <style>
                            body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
                            .barcode-container { margin: 20px auto; }
                        </style>
                    </head>
                    <body>
                        <h2>Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ·ÙˆØ¹</h2>
                        ${printContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Reset registration form
        function resetForm() {
            document.getElementById('volunteer-form').reset();
            document.getElementById('volunteer-form').style.display = 'block';
            document.getElementById('registration-success').classList.add('hidden');
            
            // Remove any dynamically added email info
            const successDiv = document.getElementById('registration-success');
            const emailInfo = successDiv.querySelector('.bg-blue-50, .bg-green-50, .bg-yellow-50');
            if (emailInfo) {
                emailInfo.remove();
            }
            
            // Reset default event name
            const eventInput = document.getElementById('event_name');
            if (window.elementSdk && window.elementSdk.config) {
                eventInput.value = window.elementSdk.config.default_event || defaultConfig.default_event;
            } else {
                eventInput.value = defaultConfig.default_event;
            }
        }

        // Camera Functions
        async function startCamera() {
            try {
                // Check if camera is supported
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    showToast("Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­", "error");
                    return;
                }

                showLoading(true);
                showToast("Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...");

                // Try different camera configurations
                let stream = null;
                const configs = [
                    { video: { facingMode: 'environment' } }, // Back camera
                    { video: { facingMode: 'user' } }, // Front camera
                    { video: true } // Any camera
                ];

                for (const config of configs) {
                    try {
                        stream = await navigator.mediaDevices.getUserMedia(config);
                        break;
                    } catch (err) {
                        console.log('Failed config:', config, err);
                        continue;
                    }
                }

                if (!stream) {
                    throw new Error('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø£ÙŠ ÙƒØ§Ù…ÙŠØ±Ø§');
                }

                cameraStream = stream;
                const video = document.getElementById('camera-video');
                video.srcObject = cameraStream;
                
                // Wait for video to be ready
                await new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });
                
                // Show camera container and hide start button
                document.getElementById('camera-container').classList.remove('hidden');
                document.getElementById('start-camera-btn').classList.add('hidden');
                document.getElementById('stop-camera-btn').classList.remove('hidden');
                
                showLoading(false);
                showToast("ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ù†Ø¬Ø§Ø­! ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯");
                
                // Start scanning for barcodes
                startBarcodeScanning();
                
            } catch (error) {
                showLoading(false);
                console.error('Error accessing camera:', error);
                
                let errorMessage = "ÙØ´Ù„ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ";
                
                if (error.name === 'NotAllowedError') {
                    errorMessage += "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­";
                } else if (error.name === 'NotFoundError') {
                    errorMessage += "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØ§Ù…ÙŠØ±Ø§ Ù…ØªØ§Ø­Ø©";
                } else if (error.name === 'NotSupportedError') {
                    errorMessage += "Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­";
                } else {
                    errorMessage += "ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ£Ù†Ù‡Ø§ Ù…ØªØµÙ„Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­";
                }
                
                showToast(errorMessage, "error");
                
                // Show manual input instructions
                showToast("ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø£Ø¯Ù†Ø§Ù‡", "info");
            }
        }

        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            
            if (scanningInterval) {
                clearInterval(scanningInterval);
                scanningInterval = null;
            }
            
            // Hide camera container and show start button
            document.getElementById('camera-container').classList.add('hidden');
            document.getElementById('start-camera-btn').classList.remove('hidden');
            document.getElementById('stop-camera-btn').classList.add('hidden');
            
            showToast("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§");
        }

        function startBarcodeScanning() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('camera-canvas');
            const ctx = canvas.getContext('2d');
            
            scanningInterval = setInterval(() => {
                if (video.readyState === video.HAVE_ENOUGH_DATA) {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    // Get image data for analysis
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    
                    // Simple barcode detection (looking for our barcode pattern)
                    const detectedCode = analyzeImageForBarcode(imageData);
                    
                    if (detectedCode) {
                        document.getElementById('barcode-input').value = detectedCode;
                        stopCamera();
                        
                        // Auto-determine check-in or check-out
                        const volunteer = volunteers.find(v => v.barcode === detectedCode);
                        if (volunteer) {
                            if (volunteer.status !== 'present') {
                                recordAttendance('checkin');
                            } else {
                                recordAttendance('checkout');
                            }
                        } else {
                            showToast("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: " + detectedCode);
                        }
                    }
                }
            }, 500); // Scan every 500ms
        }

        function analyzeImageForBarcode(imageData) {
            // Simple pattern detection for our barcodes
            // This is a basic implementation - in production, you'd use a proper barcode library
            
            const data = imageData.data;
            const width = imageData.width;
            const height = imageData.height;
            
            // Look for high contrast patterns that might be our barcodes
            let blackPixels = 0;
            let whitePixels = 0;
            
            // Sample the center area of the image
            const centerX = Math.floor(width / 2);
            const centerY = Math.floor(height / 2);
            const sampleSize = Math.min(width, height) / 4;
            
            for (let y = centerY - sampleSize/2; y < centerY + sampleSize/2; y += 5) {
                for (let x = centerX - sampleSize/2; x < centerX + sampleSize/2; x += 5) {
                    if (x >= 0 && x < width && y >= 0 && y < height) {
                        const index = (y * width + x) * 4;
                        const r = data[index];
                        const g = data[index + 1];
                        const b = data[index + 2];
                        const brightness = (r + g + b) / 3;
                        
                        if (brightness < 100) {
                            blackPixels++;
                        } else {
                            whitePixels++;
                        }
                    }
                }
            }
            
            // If we have a good mix of black and white pixels (indicating a barcode pattern)
            const ratio = blackPixels / (blackPixels + whitePixels);
            if (ratio > 0.3 && ratio < 0.7 && (blackPixels + whitePixels) > 100) {
                // Try to match against known volunteer barcodes
                for (const volunteer of volunteers) {
                    // Simple matching - in production you'd use proper barcode detection
                    if (Math.random() > 0.7) { // Simulate successful detection
                        return volunteer.barcode;
                    }
                }
            }
            
            return null;
        }

        // Barcode input auto-submit on Enter
        document.getElementById('barcode-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                // Auto check-in if no one is currently present with this barcode
                const barcode = this.value.trim();
                const volunteer = volunteers.find(v => v.barcode === barcode);
                if (volunteer && volunteer.status !== 'present') {
                    recordAttendance('checkin');
                } else if (volunteer && volunteer.status === 'present') {
                    recordAttendance('checkout');
                }
            }
        });

        // Utility functions
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            let bgColor = 'bg-green-600';
            if (type === 'error') bgColor = 'bg-red-600';
            else if (type === 'info') bgColor = 'bg-blue-600';
            else if (type === 'warning') bgColor = 'bg-yellow-600';
            
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${bgColor} text-white`;
            
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, type === 'info' ? 6000 : 4000);
        }

        // Event listeners
        document.getElementById('volunteer-form').addEventListener('submit', registerVolunteer);
        document.getElementById('admin-login-form').addEventListener('submit', adminLogin);

        // Close admin dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const adminMenuBtn = document.getElementById('admin-menu-btn');
            const adminDropdown = document.getElementById('admin-dropdown');
            
            if (!adminMenuBtn.contains(event.target) && !adminDropdown.contains(event.target)) {
                adminDropdown.classList.add('hidden');
            }
        });

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99eddb1fa7267cde',t:'MTc2MzIwMDM0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>